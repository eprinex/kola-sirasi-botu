name: ðŸ¥¤ Kola SÄ±rasÄ± Botu

on:
  schedule:
    - cron: '0 7 * * 4'    # PerÅŸembe 10:00 TRT (UTC+3 â†’ UTC 07:00)
    - cron: '10 15 * * 4'  # PerÅŸembe 18:10 TRT (UTC+3 â†’ UTC 15:10)
  workflow_dispatch:          # Manuel tetikleme (test iÃ§in)
    inputs:
      reminder_mode:
        description: 'HatÄ±rlatma modu mu? (akÅŸam mesajÄ±)'
        type: boolean
        default: false

permissions:
  contents: write   # index.json commit etmek iÃ§in gerekli

jobs:
  kola-bot:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Kodu Ä°ndir
        uses: actions/checkout@v4

      - name: ðŸ Python Kur
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ðŸ“¦ BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: pip install -r requirements.txt

      - name: ðŸ• Modu Belirle
        run: |
          if [ "${{ github.event.schedule }}" = "10 15 * * 4" ] || \
             [ "${{ github.event.inputs.reminder_mode }}" = "true" ]; then
            echo "KOLA_REMINDER=true" >> $GITHUB_ENV
            echo "Mod: HATIRLATMA (akÅŸam)"
          else
            echo "KOLA_REMINDER=false" >> $GITHUB_ENV
            echo "Mod: ANA MESAJ (sabah)"
          fi

      - name: ðŸ¤– Kola Botunu Ã‡alÄ±ÅŸtÄ±r
        env:
          GREEN_API_URL:       ${{ secrets.GREEN_API_URL }}
          GREEN_API_MEDIA_URL: ${{ secrets.GREEN_API_MEDIA_URL }}
          GREEN_API_INSTANCE:  ${{ secrets.GREEN_API_INSTANCE }}
          GREEN_API_TOKEN:     ${{ secrets.GREEN_API_TOKEN }}
          WHATSAPP_GROUP_ID:   ${{ secrets.WHATSAPP_GROUP_ID }}
          GITHUB_RAW_URL:      https://raw.githubusercontent.com/${{ github.repository }}/main
        run: python kola_bot.py

      - name: ðŸ’¾ SÄ±ra DeÄŸiÅŸikliÄŸini Kaydet (sadece ana mesaj)
        if: env.KOLA_REMINDER == 'false'
        run: |
          git config user.name  "Kola Bot ðŸ¤–"
          git config user.email "kola-bot@noreply.github.com"
          git add index.json bot_log.txt
          git diff --staged --quiet || git commit -m "ðŸ¥¤ SÄ±ra gÃ¼ncellendi [skip ci]"
          git push
